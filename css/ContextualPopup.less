// mixin classes used for creating nubs
// nub position
.moon-popup-nub-position(@nub-margintop, @nub-marginbottom, @nub-marginleft, @nub-marginright) {
	margin: rI(@nub-margintop) rI(@nub-marginright) rI(@nub-marginbottom) rI(@nub-marginleft);
}
// left nub
.moon-popup-nub-left(@nub-bgcolor) {
	border-top: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-bottom: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-right: rI(@moon-contextual-popup-nub-height) solid @nub-bgcolor;
}
// right nub
.moon-popup-nub-right(@nub-bgcolor) {
	border-top: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-bottom: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-left: rI(@moon-contextual-popup-nub-height) solid @nub-bgcolor;
}
// below nub
.moon-popup-nub-below(@nub-bgcolor) {
	border-right: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-left: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-bottom: rI(@moon-contextual-popup-nub-height) solid @nub-bgcolor;
}
// above nub
.moon-popup-nub-above(@nub-bgcolor) {
	border-right: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-left: rI((@moon-contextual-popup-nub-height - 3)) solid transparent;
	border-top: rI(@moon-contextual-popup-nub-height) solid @nub-bgcolor;
}

/* ContextualPopup */
.moon-contextual-popup {
	min-height: rI(100px);
	min-width: rI(100px);
	border-radius: rI(@moon-contextual-popup-border-radius);
	border: rI(@moon-button-border-width) solid @moon-contextual-popup-border-color;
	color: @moon-contextual-popup-text-color;
	padding: @moon-contextual-popup-padding;
	background-clip: padding-box;
	-webkit-background-clip: padding-box;
	-moz-background-clip: padding-box;
	box-sizing: border-box;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	background-color: @moon-contextual-popup-bg-color;

	&.reserve-close {
		padding-right: rI(@moon-icon-button-small-size + 10px);
	}
	&:before,
	&:after {
		position: absolute;
		content: '';
	}
	&.left:before,
	&.left:after,
	&.right:before,
	&.right:after {
		top: 50%;
	}
	&.below:before,
	&.below:after,
	&.above:before,
	&.above:after {
		left: 50%;
		right: auto;
	}
	&.high:before,
	&.high:after {
		top: rI((@moon-button-height / 2));
	}
	&.low:before,
	&.low:after {
		top: auto;
		bottom: rI((@moon-button-height / 2));
	}
	&.left:before,
	&.right:before {
		width: rI(0);
		height: rI(6px);
	}
	&.below:before,
	&.above:before {
		width: rI(6px);
		height: rI(0);
	}
	&.left:after,
	&.right:after,
	&.below:after,
	&.above:after {
		width: rI(0);
		height: rI(0);
	}

	&.left {
		margin: rI(0) rI(0) rI(0) rI(@moon-contextual-popup-gutter);

		&:before,
		&:after {
			left: rI(0);
		}
		&:before {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height), auto, rI(-@moon-contextual-popup-nub-height - 5), auto);
			.moon-popup-nub-left(@moon-contextual-popup-border-color);
		}
		&:after {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height + 3), auto, rI(-@moon-contextual-popup-nub-height), auto);
			.moon-popup-nub-left(@moon-contextual-popup-bg-color);
		}
		&.high {
			&:before {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height - 6), auto, rI(-@moon-contextual-popup-nub-height - 5), auto);
			}
			&:after {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height - 3), auto, rI(-@moon-contextual-popup-nub-height), auto);
			}
		}
		&.low {
			&:before {
				.moon-popup-nub-position(auto, rI(-@moon-contextual-popup-nub-height - 6), rI(-@moon-contextual-popup-nub-height - 5), auto);
			}
			&:after {
				.moon-popup-nub-position(auto, rI(-@moon-contextual-popup-nub-height - 3), rI(-@moon-contextual-popup-nub-height), auto);
			}
		}
	}

	&.right {
		margin: rI(0) rI(0) rI(0) rI(-@moon-contextual-popup-gutter);

		&:before,
		&:after {
			left: 100%;
			right: auto;
		}
		&:before {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height), auto, rI(@moon-button-border-width), auto);
			.moon-popup-nub-right(@moon-contextual-popup-border-color);
		}
		&:after {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height + 3), auto, rI(0), auto);
			.moon-popup-nub-right(@moon-contextual-popup-bg-color);
		}
		&.high {
			&:before {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height - 6), auto, rI(@moon-button-border-width), auto);
			}
			&:after {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height - 3), auto, rI(0), auto);
			}
		}
		&.low {
			&:before {
				.moon-popup-nub-position(auto, rI(-@moon-contextual-popup-nub-height - 6), rI(@moon-button-border-width), auto);
			}
			&:after {
				.moon-popup-nub-position(auto, rI(-@moon-contextual-popup-nub-height - 3), rI(0), auto);
			}
		}
	}

	&.below,
	&.above {
		&.right:before,
		&.right:after {
			left: 20%;
		}
		&.left:before,
		&.left:after {
			left: auto;
			right: 10%;
		}
	}

	&.below {
		margin: rI(@moon-contextual-popup-gutter) rI(0) rI(0) rI(0);

		&:before,
		&:after {
			top: rI(0);
		}
		&:before {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height - 5), auto, rI(-@moon-contextual-popup-nub-height), auto);
			.moon-popup-nub-below(@moon-contextual-popup-border-color);
		}
		&:after {
			.moon-popup-nub-position(rI(-@moon-contextual-popup-nub-height), auto, rI(-@moon-contextual-popup-nub-height + 3), auto);
			.moon-popup-nub-below(@moon-contextual-popup-bg-color);
		}
		&.right {
			&:before {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-padding - @moon-button-border-width - @moon-contextual-popup-nub-height + 4), auto, rI(-@moon-contextual-popup-nub-height), auto);
			}
			&:after {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-padding - @moon-contextual-popup-nub-height + 4), auto, rI(-@moon-contextual-popup-nub-height + 3), auto);
			}
		}
		&.left {
			&:before {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-padding - @moon-button-border-width - @moon-contextual-popup-nub-height + 4), auto, auto, rI(-@moon-contextual-popup-nub-height));
			}
			&:after {
				.moon-popup-nub-position(rI(-@moon-contextual-popup-padding - @moon-contextual-popup-nub-height + 4), auto, auto, rI(-@moon-contextual-popup-nub-height + 3));
			}
		}
	}

	&.above {
		margin: rI(-@moon-contextual-popup-gutter) rI(0) rI(0) rI(0);

		&:before,
		&:after {
			top: 100%;
		}
		&:before {
			.moon-popup-nub-position(rI(@moon-button-border-width), auto, rI(-@moon-contextual-popup-nub-height), auto);
			.moon-popup-nub-above(@moon-contextual-popup-border-color);
		}
		&:after {
			.moon-popup-nub-position(rI(0), auto, rI(-@moon-contextual-popup-nub-height + 3), auto);
			.moon-popup-nub-above(@moon-contextual-popup-bg-color);
		}
		&.right {
			&:before {
				.moon-popup-nub-position(rI(@moon-button-border-width), auto, rI(-@moon-contextual-popup-nub-height), auto);
			}
			&:after {
				.moon-popup-nub-position(rI(0), auto, rI(-@moon-contextual-popup-nub-height + 3), auto);
			}
		}
		&.left {
			&:before {
				.moon-popup-nub-position(rI(@moon-button-border-width), auto, auto, rI(-@moon-contextual-popup-nub-height));
			}
			&:after {
				.moon-popup-nub-position(rI(0), auto, auto, rI(-@moon-contextual-popup-nub-height + 3));
			}
		}
	}
}
.enyo-locale-right-to-left .moon-contextual-popup {
	direction: rtl;

	&.reserve-close {
		padding-right: rI(20px);
		padding-left: rI(@moon-icon-button-small-size + 10px);
	}
}
.moon-contextual-popup-client {
	height: 100%;
	overflow: hidden;
}